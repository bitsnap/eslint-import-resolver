'use strict';

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var fs = _interopDefault(require('fs'));
var path = _interopDefault(require('path'));

function _slicedToArray(arr, i) {
  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();
}

function _arrayWithHoles(arr) {
  if (Array.isArray(arr)) return arr;
}

function _iterableToArrayLimit(arr, i) {
  var _arr = [];
  var _n = true;
  var _d = false;
  var _e = undefined;

  try {
    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
      _arr.push(_s.value);

      if (i && _arr.length === i) break;
    }
  } catch (err) {
    _d = true;
    _e = err;
  } finally {
    try {
      if (!_n && _i["return"] != null) _i["return"]();
    } finally {
      if (_d) throw _e;
    }
  }

  return _arr;
}

function _nonIterableRest() {
  throw new TypeError("Invalid attempt to destructure non-iterable instance");
}

var _=require("lodash-magic-cache").lodashFP(["flow","get","filter","isArray","find","first","nth","defaults","isPlainObject","isEmpty","fromPairs","flatMap","uniq","map","toPairs","identity","keys","compact"]);var defaultValidExtensions=[".js",".mjs",".json",".jsx"];var settings={},dependencies={},moduleResolverSettings=_.flow(_.get("plugins"),_.filter(_.isArray),_.find(function(a){return"module-resolver"===_.first(a)}),_.nth(1),_.defaults({root:[],alias:[]})),resolverSettings=_.flow(_.get("plugins"),_.filter(_.isArray),_.find(function(a){return"resolver"===_.first(a)}),_.nth(1),_.defaults({resolveDirs:[]}),function(a){return{root:a.resolveDirs,alias:{}}});var readWebpackConfig=function(){var a,b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:".";try{a=require(path.join(b,"webpack.config.js"));}catch(a){return{root:[],alias:{}}}return _.isPlainObject(a)?{root:_.get("resolve.modules")(a)||[],alias:_.get("resolve.alias")(a)||[]}:{root:[],alias:{}}};var readSettings=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:".";if(_.isEmpty(settings)){var b;try{b=JSON.parse(fs.readFileSync("".concat(a,"/.babelrc"),{encoding:"utf8"}).toString());}catch(a){b={};}var c=moduleResolverSettings(b),d=resolverSettings(b),e=readWebpackConfig(a);settings=_.fromPairs([["root",_.flow(_.flatMap(_.get("root")),_.uniq)([d,c,e])],["alias",_.flow(_.map(_.get("alias")),_.flatMap(_.toPairs),_.uniq,_.fromPairs)([d,c,e])]]);}return _.defaults({root:[],alias:[]})(settings)};var readDependencies=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:".";if(_.isEmpty(dependencies)){var b;try{b=JSON.parse(fs.readFileSync("".concat(a,"/package.json"),{encoding:"utf8"}).toString());}catch(a){b={};}dependencies=_.flow(function(a){return _.flatMap(_.identity)(_.map(function(b){return _.keys(_.get(b)(a))})(["dependencies","peerDependencies","devDependencies"]))},_.uniq,_.compact)(b);}return dependencies};

var _$1=require("lodash-magic-cache").lodashFP(["concat","map","find","get"]);var fileExists=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:defaultValidExtensions,c=_$1.concat(a,_$1.map(function(b){return"".concat(a).concat(b)})(b));return _$1.find(function(a){try{return fs.lstatSync(a).isFile()}catch(a){return!1}})(c)};var dirExists=function(a){try{return fs.lstatSync(a).isDirectory()}catch(a){return!1}};var exists=function(a,b){var c=fileExists(a,b);if(c)return c;if(dirExists(a)){if(c=fileExists(path.join(a,"index"),b), c)return c;if(fileExists(path.join(a,"package.json"))){var d=JSON.parse(fs.readFileSync("".concat(a,"/package.json"),{encoding:"utf8"}).toString()),e=_$1.get("jsnext:main")(d)||_$1.get("main")(d);if(c=path.join(a,e), fileExists(c,b))return c}}return!1};

var _$2=require("lodash-magic-cache").lodashFP(["includes"]);var coreModules=["assert","async_hooks","buffer_ieee754","buffer","child_process","cluster","console","constants","crypto","_debugger","dgram","dns","domain","events","freelist","fs","_http_agent","_http_client","_http_common","_http_incoming","_http_outgoing","_http_server","http","http2","https","inspector","_linklist","module","net","node-inspect/lib/_inspect","node-inspect/lib/internal/inspect_client","node-inspect/lib/internal/inspect_repl","os","path","perf_hooks","process","punycode","querystring","readline","repl","smalloc","_stream_duplex","_stream_transform","_stream_wrap","_stream_passthrough","_stream_readable","_stream_writable","stream","string_decoder","sys","timers","_tls_common","_tls_legacy","_tls_wrap","tls","tty","url","util","v8/tools/codemap","v8/tools/consarray","v8/tools/csvparser","v8/tools/logreader","v8/tools/profile_view","v8/tools/splaytree","v8","vm","zlib"];function isCore(a){return _$2.includes(a)(coreModules)}

var _$3=require("lodash-magic-cache").lodashFP(["flow","defaults","get","isEmpty","reduce","replace","entries","map","compact","nth","find","startsWith"]);var resolve=function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(isCore(a))return{found:!0,path:a};var d=_$3.flow(_$3.defaults({root:process.cwd()}),_$3.get("root"))(c);if(_$3.isEmpty(a)||!a)return{found:!1};var e=readSettings(d),g="".concat(a);g=_$3.reduce(function(a,b){var c=_slicedToArray(b,2),d=c[0],e=c[1];return _$3.flow(_$3.replace(new RegExp("^".concat(d)),e),_$3.replace(new RegExp("".concat(d,"$")),e))(a)})(g)(_$3.entries(e.alias));var h=_$3.flow(_$3.defaults({extensions:defaultValidExtensions}),_$3.get("extensions"))(c),i=_$3.replace(/$.\//,"")(g),j=path.join(path.dirname(b),i),k=exists(j,h);if(k)return{found:!0,path:k};var f=_$3.map(function(a){return path.join(d,a,g)})(e.root);if(k=_$3.flow(_$3.map(function(a){return exists(a,h)}),_$3.compact,_$3.nth(0))(f), k)return{found:!0,path:k};var l=readDependencies(d);return _$3.find(function(b){return _$3.startsWith(b)(a)})(l)&&(k=exists(path.join(d,"node_modules",a),h), k)?{found:!0,path:k}:{found:!1}};

var _$4=require("lodash-magic-cache").lodash([]);var main = {interfaceVersion:2,resolve:resolve};

module.exports = main;
//# sourceMappingURL=import-resolver.min.js.map

'use strict';

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var fs = _interopDefault(require('fs'));
var path = _interopDefault(require('path'));

function _slicedToArray(arr, i) {
  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();
}

function _arrayWithHoles(arr) {
  if (Array.isArray(arr)) return arr;
}

function _iterableToArrayLimit(arr, i) {
  var _arr = [];
  var _n = true;
  var _d = false;
  var _e = undefined;

  try {
    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
      _arr.push(_s.value);

      if (i && _arr.length === i) break;
    }
  } catch (err) {
    _d = true;
    _e = err;
  } finally {
    try {
      if (!_n && _i["return"] != null) _i["return"]();
    } finally {
      if (_d) throw _e;
    }
  }

  return _arr;
}

function _nonIterableRest() {
  throw new TypeError("Invalid attempt to destructure non-iterable instance");
}

var _=require("lodash-magic-cache").lodashFP(["flow","get","filter","isArray","find","first","nth","defaults","isPlainObject","isString","isRegExp","keys","isEmpty","fromPairs","flatMap","uniq","map","toPairs","identity","compact"]);var defaultValidExtensions=[".js",".mjs",".json",".jsx"];var settings={},dependencies={},moduleResolverSettings=_.flow(_.get("plugins"),_.filter(_.isArray),_.find(function(a){return"module-resolver"===_.first(a)}),_.nth(1),_.defaults({root:[],alias:[],externals:[]})),resolverSettings=_.flow(_.get("plugins"),_.filter(_.isArray),_.find(function(a){return"resolver"===_.first(a)}),_.nth(1),_.defaults({resolveDirs:[]}),function(a){return{root:a.resolveDirs,alias:{},externals:[]}});var readWebpackConfig=function(){var a,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:".",c=1<arguments.length?arguments[1]:void 0;try{a=require(path.join(b,"webpack.config.js"));}catch(a){return{root:[],alias:{},externals:[]}}var d=_.get("webpackConfigIndex")(c)||0;if(_.isArray(a))a=_.nth(d)(a)||{};else if(!_.isPlainObject(a))return{root:[],alias:{},externals:[]};var e=_.get("externals")(a)||[];return _.isArray(e)&&(e=_.filter(function(a){return _.isString(a)||_.isRegExp(a)})(e)),_.isPlainObject(e)&&(e=_.keys(e)),{root:_.get("resolve.modules")(a)||[],alias:_.get("resolve.alias")(a)||[],externals:e}};var parseJson=function(a,b){try{return JSON.parse(fs.readFileSync("".concat(a,"/").concat(b),{encoding:"utf8"}).toString())}catch(a){return{}}};var readSettings=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:".",b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(_.isEmpty(settings)){var c=parseJson(a,".babelrc"),d=moduleResolverSettings(c),e=resolverSettings(c),f=readWebpackConfig(a,b);settings=_.fromPairs([["root",_.flow(_.flatMap(_.get("root")),_.uniq)([e,d,f])],["alias",_.flow(_.map(_.get("alias")),_.flatMap(_.toPairs),_.uniq,_.fromPairs)([e,d,f])],["externals",_.get("externals")(f)]]);}return _.defaults({root:[],alias:[],externals:[]})(settings)};var readDependencies=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:".";if(_.isEmpty(dependencies)){var b=parseJson(a,"package.json");dependencies=_.flow(function(a){return _.flatMap(_.identity)(_.map(function(b){return _.keys(_.get(b)(a))})(["dependencies","peerDependencies","devDependencies"]))},_.uniq,_.compact)(b);}return dependencies};

var _$1=require("lodash-magic-cache").lodashFP(["concat","map","find","reduce","get"]);var fileExists=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:defaultValidExtensions,c=_$1.concat(a,_$1.map(function(b){return"".concat(a).concat(b)})(b));return _$1.find(function(a){try{return fs.lstatSync(a).isFile()}catch(a){return!1}})(c)};var exists=function(a,b){return _$1.reduce(function(a,b){return a?a:b()})(!1)([function(){return fileExists(a,b)},function(){return fileExists(path.join(a,"index"),b)},function(){if(fileExists(path.join(a,"package.json"))){var c=parseJson(a,"package.json"),d=_$1.get("jsnext:main")(c)||_$1.get("main")(c)||null;if(d)return fileExists(path.join(a,d),b)}return!1}])};

var _$2=require("lodash-magic-cache").lodashFP(["includes"]);var coreModules=["assert","async_hooks","buffer_ieee754","buffer","child_process","cluster","console","constants","crypto","_debugger","dgram","dns","domain","events","freelist","fs","_http_agent","_http_client","_http_common","_http_incoming","_http_outgoing","_http_server","http","http2","https","inspector","_linklist","module","net","node-inspect/lib/_inspect","node-inspect/lib/internal/inspect_client","node-inspect/lib/internal/inspect_repl","os","path","perf_hooks","process","punycode","querystring","readline","repl","smalloc","_stream_duplex","_stream_transform","_stream_wrap","_stream_passthrough","_stream_readable","_stream_writable","stream","string_decoder","sys","timers","_tls_common","_tls_legacy","_tls_wrap","tls","tty","url","util","v8/tools/codemap","v8/tools/consarray","v8/tools/csvparser","v8/tools/logreader","v8/tools/profile_view","v8/tools/splaytree","v8","vm","zlib"];function isCore(a){return _$2.includes(a)(coreModules)}

var _$3=require("lodash-magic-cache").lodashFP(["reduce","flow","replace","entries","find","isString","startsWith","map","compact","nth","overSome","isEmpty","defaults","get"]);var replaceAliases=function(a,b){return _$3.reduce(function(a,b){var c=_slicedToArray(b,2),d=c[0],e=c[1];return _$3.flow(_$3.replace(new RegExp("^".concat(d)),e),_$3.replace(new RegExp("".concat(d,"$")),e))(a)})(a)(_$3.entries(b))},lookupRelative=function(a,b,c){var d=_$3.replace(/$.\//,"")(a),e=path.join(path.dirname(b),d);return exists(e,c)},lookupExternals=function(a,b){return!!_$3.find(function(b){return _$3.isString(b)?_$3.startsWith(b)(a):a.match(b)})(b)},lookupRoot=function(a,b,c,d){var e=_$3.map(function(c){return path.join(b,c,a)})(c);return _$3.flow(_$3.map(function(a){return exists(a,d)}),_$3.compact,_$3.nth(0))(e)},lookupDeps=function(a,b,c,d){return!!_$3.find(function(b){return _$3.startsWith(b)(a)})(c)&&exists(path.join(b,"node_modules",a),d)},resolve=function(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};if(_$3.overSome([_$3.isEmpty,function(a){return!a}])(a))return{found:!1};if(isCore(a))return{found:!0};var d=_$3.flow(_$3.defaults({root:process.cwd(),extensions:defaultValidExtensions}),function(a){return{root:_$3.get("root")(a),validExtensions:_$3.get("extensions")(a)}})(c),e=d.root,f=d.validExtensions,g=readSettings(e,c),h=replaceAliases(a,g.alias),i=readDependencies(e),j=_$3.reduce(function(a,b){return a?a:b()})(!1)([function(){return lookupRelative(h,b,f)},function(){return lookupExternals(h,g.externals)},function(){return lookupRoot(h,e,g.root,f)},function(){return lookupDeps(h,e,i,f)}]);return{found:_$3.isString(j)||!0===j,path:j}};

var _$4=require("lodash-magic-cache").lodash([]);var main = {interfaceVersion:2,resolve:resolve};

module.exports = main;
//# sourceMappingURL=import-resolver.min.js.map

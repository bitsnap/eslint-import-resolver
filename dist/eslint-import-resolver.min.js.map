{"version":3,"file":"eslint-import-resolver.min.js","sources":["../src/settings.js","../src/exists.js","../src/core.js","../src/resolver.js","../src/main.js"],"sourcesContent":["import fs from 'fs';\nimport _ from 'lodash/fp';\n\nexport const defaultValidExtensions = ['.js', '.mjs', '.json', '.jsx'];\n\nlet settings = {};\nlet dependencies = {};\n\nconst moduleResolverSettings = _.flow(\n  _.get('plugins'),\n  _.filter(_.isArray),\n  _.find(p => _.first(p) === 'module-resolver'),\n  _.nth(1),\n  _.defaults({\n    root: [],\n    alias: [],\n  }),\n);\n\nconst resolverSettings = _.flow(\n  _.get('plugins'),\n  _.filter(_.isArray),\n  _.find(p => _.first(p) === 'resolver'),\n  _.nth(1),\n  _.defaults({\n    resolveDirs: [],\n  }),\n  r => ({ root: r.resolveDirs, alias: {} }),\n);\n\nexport const clear = () => {\n  settings = {};\n  dependencies = {};\n};\n\nexport const readSettings = (rootDir = '.') => {\n  if (_.isEmpty(settings)) {\n    let babelRC;\n    try {\n      babelRC = JSON.parse(fs.readFileSync(`${rootDir}/.babelrc`, {\n        encoding: 'utf8',\n      }).toString());\n    } catch (err) {\n      babelRC = {};\n    }\n\n    const mrs = moduleResolverSettings(babelRC);\n    const ms = resolverSettings(babelRC);\n\n    settings = _.fromPairs([\n      ['root', _.uniq(_.concat(_.get('root')(ms), _.get('root')(mrs)))],\n      ['alias', _.fromPairs(_.concat(\n        _.toPairs(_.get('alias')(ms)),\n        _.toPairs(_.get('alias')(mrs)),\n      ))],\n    ]);\n  }\n\n  return _.defaults({\n    root: [],\n    alias: [],\n  })(settings);\n};\n\nexport const readDependencies = (rootDir = '.') => {\n  if (_.isEmpty(dependencies)) {\n    let p;\n    try {\n      p = JSON.parse(fs.readFileSync(`${rootDir}/package.json`, {\n        encoding: 'utf8',\n      }).toString());\n    } catch (err) {\n      p = {};\n    }\n\n    dependencies = _.flow(\n      pkg => _.flatMap(_.identity)(_.map(d => _.keys(_.get(d)(pkg)))([\n        'dependencies',\n        'peerDependencies',\n        'devDependencies',\n      ])),\n      _.uniq,\n      _.compact,\n    )(p);\n  }\n\n  return dependencies;\n};\n","import _ from 'lodash/fp';\nimport fs from 'fs';\nimport path from 'path';\n\nimport { defaultValidExtensions } from 'settings';\n\nexport const fileExists = (p, validExtensions = defaultValidExtensions) => {\n  const paths = _.concat(\n    p,\n    _.map(e => `${p}${e}`)(validExtensions),\n  );\n\n  return _.find((f) => {\n    try {\n      return fs.lstatSync(f).isFile();\n    } catch (err) {\n      return false;\n    }\n  })(paths);\n};\n\nexport const dirExists = (p) => {\n  try {\n    return fs.lstatSync(p).isDirectory();\n  } catch (e) {\n    return false;\n  }\n};\n\nconst exists = (mod, validExtensions) => {\n  let f = fileExists(mod, validExtensions);\n  if (f) {\n    return f;\n  }\n\n  if (dirExists(mod)) {\n    f = fileExists(path.join(mod, 'index'), validExtensions);\n    if (f) {\n      return f;\n    }\n\n    if (fileExists(path.join(mod, 'package.json'))) {\n      const p = JSON.parse(fs.readFileSync(`${mod}/package.json`, {\n        encoding: 'utf8',\n      }).toString());\n\n      const main = _.get('jsnext:main')(p) || _.get('main')(p);\n      f = path.join(mod, main);\n      if (fileExists(f, validExtensions)) {\n        return f;\n      }\n    }\n  }\n\n  return false;\n};\n\nexport default exists;\n","\nimport _ from 'lodash/fp';\n\nexport const coreModules = [\n  'assert', 'async_hooks', 'buffer_ieee754',\n  'buffer', 'child_process', 'cluster', 'console',\n  'constants', 'crypto', '_debugger', 'dgram',\n  'dns', 'domain', 'events', 'freelist', 'fs',\n  '_http_agent', '_http_client', '_http_common', '_http_incoming',\n  '_http_outgoing', '_http_server', 'http', 'http2', 'https',\n  'inspector', '_linklist', 'module', 'net',\n  'node-inspect/lib/_inspect',\n  'node-inspect/lib/internal/inspect_client',\n  'node-inspect/lib/internal/inspect_repl',\n  'os', 'path', 'perf_hooks', 'process', 'punycode', 'querystring',\n  'readline', 'repl', 'smalloc',\n  '_stream_duplex', '_stream_transform', '_stream_wrap', '_stream_passthrough', '_stream_readable', '_stream_writable',\n  'stream', 'string_decoder',\n  'sys', 'timers',\n  '_tls_common', '_tls_legacy', '_tls_wrap',\n  'tls', 'tty', 'url', 'util',\n  'v8/tools/codemap', 'v8/tools/consarray', 'v8/tools/csvparser', 'v8/tools/logreader', 'v8/tools/profile_view', 'v8/tools/splaytree',\n  'v8', 'vm', 'zlib',\n];\n\nexport default function isCore(mod) {\n  return _.includes(mod)(coreModules);\n}\n","// because tleunen/babel-plugin-module-resolver is broken\n// and building an import resolver is not a rocket science\n\nimport path from 'path';\nimport _ from 'lodash/fp';\n\nimport exists from 'exists';\nimport isCore from 'core';\n\nimport { readSettings, readDependencies, defaultValidExtensions } from 'settings';\n\nconst resolve = (source, file, options = {}) => {\n  if (isCore(source)) {\n    return { found: true, path: source };\n  }\n\n  const root = _.flow(\n    _.defaults({\n      root: process.cwd(),\n    }),\n    _.get('root'),\n  )(options);\n\n  if (_.isEmpty(source) || !source) {\n    return { found: false };\n  }\n\n  const settings = readSettings(root);\n\n  let aliasedSource = `${source}`;\n\n  aliasedSource = _.reduce((r, v) => {\n    const [alias, mod] = v;\n\n    return _.flow(\n      _.replace(new RegExp(`^${alias}`), mod),\n      _.replace(new RegExp(`${alias}$`), mod),\n    )(r);\n  })(aliasedSource)(_.entries(settings.alias));\n\n  const validExtensions = _.flow(\n    _.defaults({\n      extensions: defaultValidExtensions,\n    }),\n    _.get('extensions'),\n  )(options);\n\n  const rel = _.replace(/$.\\//, '')(aliasedSource);\n  const curDirMod = path.join(path.dirname(file), rel);\n  let f = exists(curDirMod, validExtensions);\n  if (f) {\n    return { found: true, path: f };\n  }\n\n  const rootPaths = _.map(r => path.join(root, r, aliasedSource))(settings.root);\n  f = _.flow(\n    _.map(p => exists(p, validExtensions)),\n    _.compact,\n    _.nth(0),\n  )(rootPaths);\n  if (f) {\n    return { found: true, path: f };\n  }\n\n  const deps = readDependencies(root);\n\n  if (_.find(d => _.startsWith(d)(source))(deps)) {\n    f = exists(path.join(root, 'node_modules', source), validExtensions);\n    if (f) {\n      return { found: true, path: f };\n    }\n  }\n\n  return { found: false };\n};\n\nexport default resolve;\n","import resolve from 'resolver';\n\nexport default {\n  interfaceVersion: 2,\n  resolve,\n};\n"],"names":["dependencies","moduleResolverSettings","_","flow","get","filter","isArray","find","first","p","nth","defaults","root","alias","resolverSettings","resolveDirs","r","isEmpty","settings","babelRC","JSON","parse","fs","readFileSync","rootDir","encoding","toString","err","ms","fromPairs","uniq","concat","mrs","toPairs","flatMap","identity","map","keys","d","pkg","compact","defaultValidExtensions","paths","e","validExtensions","f","lstatSync","isFile","isDirectory","mod","fileExists","dirExists","path","join","main","includes","coreModules","source","file","isCore","found","process","cwd","options","readSettings","aliasedSource","reduce","v","replace","entries","extensions","rel","curDirMod","dirname","exists","rootPaths","readDependencies","startsWith","deps","interfaceVersion","resolve"],"mappings":"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"}